<!DOCTYPE html>
<html>
<head>
    <title>ìŒì„±ìœ¼ë¡œ ë„ì „í–‰ë™ ê¸°ë¡í•˜ê¸°</title>
</head>
<body>
    <h2>ğŸ¤ ë§í•´ì„œ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ì— ê¸°ë¡</h2>
    <button id="start">ë§í•˜ê¸° ì‹œì‘</button>
    <p id="output">ì—¬ê¸°ì— ì¸ì‹ëœ í…ìŠ¤íŠ¸ê°€ ëœ¹ë‹ˆë‹¤</p>
    <script>
        const startBtn = document.getElementById('start');
        const output = document.getElementById('output');
        
        const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        recognition.lang = 'ko-KR';

        startBtn.onclick = () => {
            recognition.start();
            output.textContent = 'ë“£ëŠ” ì¤‘...';
        }

        recognition.onresult = function(event) {
            const transcript = event.results[0][0].transcript;
            output.textContent = transcript;
            
            // ë§í•œ ë‚´ìš©ì„ ì „ì†¡
            fetch("https://script.google.com/macros/s/AKfycbxfgymI_VYnOq0MRncOh7eskXJEfIMOQu1aZjyjo1WqEeQCmJMZn7KLVDosFgwZvPEb4Q/exec", {
                method: "POST",
                mode: 'no-cors',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(parseSpeech(transcript))
            });
        }

        function parseSpeech(text) {
            // ê°„ë‹¨íˆ í‚¤ì›Œë“œ ì°¾ì•„ì„œ ë°ì´í„° ë‚˜ëˆ„ê¸°
            const data = {
                name: '', date: '', behavior: '', intensity: '', time: '', duration: '', location: '', action: ''
            };

            const regexMap = {
                name: /ì´ë¦„ì€ (.+?)(,|\.|\s|$)/,
                date: /ë‚ ì§œëŠ” (.+?)(,|\.|\s|$)/,
                behavior: /(ë„ì „í–‰ë™ì€|í–‰ë™ì€) (.+?)(,|\.|\s|$)/,
                intensity: /ê°•ë„ëŠ” (.+?)(,|\.|\s|$)/,
                time: /ì‹œê°„ì€ (.+?)(,|\.|\s|$)/,
                duration: /ì§€ì†ì‹œê°„ì€ (.+?)(,|\.|\s|$)/,
                location: /ì¥ì†ŒëŠ” (.+?)(,|\.|\s|$)/,
                action: /ì¡°ì¹˜ì‚¬í•­ì€ (.+?)(,|\.|\s|$)/,
            };

            for (let key in regexMap) {
                const match = text.match(regexMap[key]);
                if (match) {
                    data[key] = match[1].trim();
                }
            }

            return data;
        }
    </script>
</body>
</html>
